<!DOCTYPE html>
<html lang="ru" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mouse & Keyboard Tester ‚Äî v0.2 (Vanilla JS)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            slate: tailwind.colors.slate
          }
        }
      }
    }
  </script>
  <style>
    /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
    body {
      background-color: rgb(2 6 23);
      color: rgb(226 232 240);
    }
    
    /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
    body.light-theme {
      background-color: rgb(248 250 252) !important;
      color: rgb(15 23 42) !important;
    }
    
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–æ–Ω—ã –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã */
    body.light-theme .bg-slate-950 { background-color: rgb(248 250 252) !important; }
    body.light-theme .bg-slate-900 { background-color: rgb(226 232 240) !important; }
    body.light-theme .bg-slate-800 { background-color: rgb(203 213 225) !important; }
    body.light-theme .bg-slate-700 { background-color: rgb(148 163 184) !important; }
    body.light-theme .bg-slate-600 { background-color: rgb(71 85 105) !important; }
    
    /* –§–æ–Ω—ã —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã */
    body.light-theme .bg-slate-800\/50 { background-color: rgb(203 213 225 / 0.5) !important; }
    body.light-theme .bg-slate-800\/60 { background-color: rgb(203 213 225 / 0.6) !important; }
    body.light-theme .bg-emerald-900\/10 { background-color: rgb(6 95 70 / 0.1) !important; }
    body.light-theme .bg-red-900\/20 { background-color: rgb(127 29 29 / 0.2) !important; }
    
    /* –ì—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã */
    body.light-theme .border-slate-800 { border-color: rgb(203 213 225) !important; }
    body.light-theme .border-slate-700 { border-color: rgb(148 163 184) !important; }
    body.light-theme .border-slate-800\/60 { border-color: rgb(203 213 225 / 0.6) !important; }
    body.light-theme .border-emerald-500 { border-color: rgb(34 197 94) !important; }
    
    /* –¶–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã */
    body.light-theme .text-slate-200 { color: rgb(15 23 42) !important; }
    body.light-theme .text-slate-300 { color: rgb(51 65 85) !important; }
    body.light-theme .text-slate-400 { color: rgb(71 85 105) !important; }
    body.light-theme .text-slate-500 { color: rgb(100 116 139) !important; }
    body.light-theme .text-red-300 { color: rgb(220 38 38) !important; }
    body.light-theme .text-red-400 { color: rgb(220 38 38) !important; }
    
    /* Hover —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã */
    body.light-theme .hover\:bg-slate-700:hover { background-color: rgb(148 163 184) !important; }
    body.light-theme .hover\:bg-slate-800:hover { background-color: rgb(148 163 184) !important; }
    
    /* –ö–æ–ª—å—Ü–∞ —Ñ–æ–∫—É—Å–∞ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã */
    body.light-theme .ring-emerald-500\/50 { --tw-ring-color: rgb(34 197 94 / 0.5) !important; }
    body.light-theme .focus\:ring-emerald-500:focus { --tw-ring-color: rgb(34 197 94) !important; }
    body.light-theme .ring-2 { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000); }
    
    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã */
    body.light-theme header { border-color: rgb(203 213 225) !important; }
    body.light-theme main { color: rgb(15 23 42) !important; }
    body.light-theme section { color: rgb(15 23 42) !important; }
    body.light-theme button { color: rgb(15 23 42) !important; }
    body.light-theme input { background-color: rgb(203 213 225) !important; border-color: rgb(148 163 184) !important; color: rgb(15 23 42) !important; }
    body.light-theme table { color: rgb(15 23 42) !important; }
    body.light-theme th { color: rgb(71 85 105) !important; }
    body.light-theme td { color: rgb(51 65 85) !important; }
  </style>
</head>
<body class="font-sans h-full">
  <header class="border-b border-slate-800">
    <div class="mx-auto max-w-7xl px-4 py-4 flex items-center justify-between gap-4">
      <h1 class="text-xl sm:text-2xl font-semibold tracking-tight">Mouse & Keyboard Tester</h1>
      <div class="flex items-center gap-3">
        <button id="btn-mode" class="rounded-xl px-3 py-2 bg-slate-800 hover:bg-slate-700 text-sm">üñ±Ô∏è –ú—ã—à—å</button>
        <button id="btn-reset" class="rounded-xl px-3 py-2 bg-slate-800 hover:bg-slate-700 text-sm">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        <button id="btn-export" class="rounded-xl px-3 py-2 bg-slate-800 hover:bg-slate-700 text-sm">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
        <button id="btn-theme" class="rounded-xl px-3 py-2 bg-slate-800 hover:bg-slate-700 text-sm">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è</button>
        <button id="btn-lang" class="rounded-xl px-3 py-2 bg-slate-800 hover:bg-slate-700 text-sm">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
      </div>
    </div>
    <!-- Top Ad Slot -->
    <div class="mx-auto max-w-7xl px-4 pb-4">
      <div class="w-full min-h-16 sm:min-h-20 md:min-h-24 rounded-xl bg-slate-800/60 flex items-center justify-center text-slate-400 text-xs">
        –†–µ–∫–ª–∞–º–Ω—ã–π –±–∞–Ω–Ω–µ—Ä (728x90 / –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π)
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-7xl grid grid-cols-1 lg:grid-cols-12 gap-4 p-4">
    <!-- Controls -->
    <section class="lg:col-span-3 space-y-4">
      <div class="rounded-2xl bg-slate-900 border border-slate-800 p-4">
        <h2 class="text-lg font-semibold mb-3">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
        <div class="space-y-4">
          <div>
            <label class="text-sm text-slate-300">–ü–æ—Ä–æ–≥ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞ (–º—Å)</label>
            <input id="dbl-threshold" type="number" min="50" max="500" step="10" value="70" class="mt-1 w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
            <p class="text-xs text-slate-400 mt-1">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∫–ª–∏–∫–∞–º–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ: 150-250–º—Å.</p>
          </div>
          <div>
            <label class="text-sm text-slate-300">–û–∫–Ω–æ —Ä–µ–≤–µ—Ä—Å–∞ –∫–æ–ª–µ—Å–∞ (–º—Å)</label>
            <input id="reverse-window" type="number" min="20" max="200" step="5" value="80" class="mt-1 w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2" />
            <p class="text-xs text-slate-400 mt-1">–ï—Å–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—è–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ —ç—Ç–æ–≥–æ –æ–∫–Ω–∞ ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ä–µ–≤–µ—Ä—Å.</p>
          </div>
        </div>
      </div>

      <div class="rounded-2xl bg-slate-900 border border-slate-800 p-4">
        <h2 class="text-lg font-semibold mb-3">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <ul class="space-y-2 text-sm">
          <li class="flex items-center justify-between"><span>–î–∞–±–±–ª-–∫–ª–∏–∫–∏ LMB:</span><span id="dbl-lmb" class="font-mono">0</span></li>
          <li class="flex items-center justify-between"><span>–î–∞–±–±–ª-–∫–ª–∏–∫–∏ MMB:</span><span id="dbl-mmb" class="font-mono">0</span></li>
          <li class="flex items-center justify-between"><span>–î–∞–±–±–ª-–∫–ª–∏–∫–∏ RMB:</span><span id="dbl-rmb" class="font-mono">0</span></li>
          <li class="flex items-center justify-between"><span>–ö–æ–ª-–≤–æ —à–∞–≥–æ–≤ –∫–æ–ª–µ—Å–∞:</span><span id="wheel-total" class="font-mono">0</span></li>
          <li class="flex items-center justify-between"><span>–†–µ–≤–µ—Ä—Å—ã –∫–æ–ª–µ—Å–∞:</span><span id="wheel-rev" class="font-mono">0</span></li>
        </ul>
      </div>

      <!-- Sidebar Ad Slot -->
      <div class="rounded-2xl bg-slate-900 border border-slate-800 p-4">
        <div class="w-full min-h-48 rounded-xl bg-slate-800/60 flex items-center justify-center text-slate-400 text-xs">
          –†–µ–∫–ª–∞–º–Ω—ã–π –±–ª–æ–∫ (300x250 / –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π)
        </div>
      </div>
    </section>

    <!-- Test Area -->
    <section class="lg:col-span-6 space-y-4">
      <div id="test-area" tabindex="0"
           class="rounded-2xl border border-slate-800 bg-slate-900 p-4 outline-none focus:ring-2 focus:ring-emerald-500 min-h-[360px] select-none relative">
        <h2 class="text-lg font-semibold mb-3 text-center">–ó–æ–Ω–∞ —Ç–µ—Å—Ç–∞ –º—ã—à–∏</h2>
        <p class="text-sm text-slate-400 mb-4 text-center">–ö–ª–∏–∫–∞–π—Ç–µ –õ–ö–ú/–°–ö–ú/–ü–ö–ú –∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–π—Ç–µ –∫–æ–ª–µ—Å–æ. –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –∏ –∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π –∑–æ–Ω—ã.</p>

        <!-- Notification Area -->
        <div id="notification-area" class="absolute top-4 right-4 space-y-2 pointer-events-none z-10"></div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
          <div id="ind-lmb" class="rounded-2xl border p-4 flex items-center justify-between border-slate-800 bg-slate-900">
            <span class="font-medium">–õ–ö–ú</span>
            <span class="size-3 rounded-full bg-slate-700"></span>
          </div>
          <div id="ind-mmb" class="rounded-2xl border p-4 flex items-center justify-between border-slate-800 bg-slate-900">
            <span class="font-medium">–°–ö–ú</span>
            <span class="size-3 rounded-full bg-slate-700"></span>
          </div>
          <div id="ind-rmb" class="rounded-2xl border p-4 flex items-center justify-between border-slate-800 bg-slate-900">
            <span class="font-medium">–ü–ö–ú</span>
            <span class="size-3 rounded-full bg-slate-700"></span>
          </div>
        </div>

        <div class="mt-6 flex items-center justify-center">
          <div class="flex items-center gap-4">
            <div id="arrow-up" class="size-8 border-2 border-slate-800 bg-slate-900 flex items-center justify-center text-xs font-mono rounded">‚Üë</div>
            <span id="wheel-label" class="text-sm font-medium">–ö–æ–ª–µ—Å–æ</span>
            <div id="arrow-down" class="size-8 border-2 border-slate-800 bg-slate-900 flex items-center justify-center text-xs font-mono rounded">‚Üì</div>
          </div>
        </div>
        
        <!-- Hints moved to bottom -->
        <div class="mt-4 text-xs text-slate-500 bg-slate-800/50 rounded-xl p-3">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            <div>üí° <strong>–õ–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞:</strong> –±—ã—Å—Ç—Ä–æ –∫–ª–∏–∫–∞–π—Ç–µ –¥–ª—è —Ç–µ—Å—Ç–∞ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞</div>
            <div>üí° <strong>–°—Ä–µ–¥–Ω—è—è –∫–Ω–æ–ø–∫–∞:</strong> –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –∫–æ–ª–µ—Å–∏–∫–∞ –∫–∞–∫ –∫–Ω–æ–ø–∫–∏</div>
            <div>üí° <strong>–ü—Ä–∞–≤–∞—è –∫–Ω–æ–ø–∫–∞:</strong> –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –æ—Ç–∫–ª—é—á–µ–Ω–æ</div>
            <div>üí° <strong>–ö–æ–ª–µ—Å–æ:</strong> –º–µ–Ω—è–π—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∞ —Ä–µ–≤–µ—Ä—Å–æ–≤</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Logs -->
    <section class="lg:col-span-3 space-y-4">
      <div class="rounded-2xl bg-slate-900 border border-slate-800 p-4">
        <h2 class="text-lg font-semibold mb-3 text-center">–õ–æ–≥–∏</h2>
        <div class="h-[420px] overflow-y-auto overflow-x-hidden pr-2">
          <table class="w-full text-sm table-fixed">
            <thead class="sticky top-0 bg-slate-900">
              <tr class="text-slate-400 border-b border-slate-800">
                <th class="text-center font-medium py-2 w-20">–í—Ä–µ–º—è</th>
                <th class="text-center font-medium py-2 w-24">–°–æ–±—ã—Ç–∏–µ</th>
                <th class="text-center font-medium py-2 break-words">–î–µ—Ç–∞–ª–∏</th>
              </tr>
            </thead>
            <tbody id="log-body">
              <!-- –õ–æ–≥–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Advertisement Block -->
      <div class="rounded-2xl bg-slate-900 border border-slate-800 p-4">
        <div class="w-full min-h-48 rounded-xl bg-slate-800/60 flex items-center justify-center text-slate-400 text-xs">
          –†–µ–∫–ª–∞–º–Ω—ã–π –±–ª–æ–∫ (300x250 / –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π)
        </div>
      </div>
    </section>
  </main>

  <!-- Full-width separator -->
  <div class="w-full border-t border-slate-800 mt-8"></div>

  <footer class="mx-auto max-w-7xl px-4 pb-8 text-center text-sm text-slate-500 pt-8">
    <p>–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.<br>2025</p>
  </footer>

  <script>
    // ------- State -------
    let dblThresholdMs = 70;
    let reverseWindowMs = 80;
    let isDarkTheme = true;
    let currentLang = 'ru'; // ru –∏–ª–∏ en
    let testMode = 'mouse'; // mouse –∏–ª–∏ keyboard

    const logs = []; // newest first (limit 1000)
    const doubleCounts = {}; // –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
    const wheelStats = { reversals: 0, total: 0 };

    const lastDown = { 0: 0, 1: 0, 2: 0 }; // per-button last mousedown time
    const lastWheel = { t: 0, sign: 0 };
    let wheelIdleTimer = null;

    // –ü–µ—Ä–µ–≤–æ–¥—ã
    const translations = {
      ru: {
        title: 'Mouse & Keyboard Tester',
        clear: 'üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å',
        export: 'üì• –≠–∫—Å–ø–æ—Ä—Ç',
        lightTheme: '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è',
        darkTheme: 'üåô –¢–µ–º–Ω–∞—è',
        lang: 'üá∑üá∫ –†—É—Å—Å–∫–∏–π',
        modeMouseTest: 'üñ±Ô∏è –ú—ã—à—å',
        modeKeyboardTest: '‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞',
        doubleClickSpeed: '–°–∫–æ—Ä–æ—Å—Ç—å –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞:',
        ms: '–º—Å',
        wheelSettings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–ª–µ—Å–∏–∫–∞:',
        reversalWindow: '–û–∫–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏—è:',
        mouseButtons: '–ö–Ω–æ–ø–∫–∏ –º—ã—à–∏',
        wheelScroll: '–ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫–æ–ª–µ—Å–∞',
        reversals: '–û–±—Ä–∞—â–µ–Ω–∏—è',
        keyboard: '–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞',
        logs: '–õ–æ–≥–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 1000)',
        time: '–í—Ä–µ–º—è',
        event: '–°–æ–±—ã—Ç–∏–µ', 
        details: '–î–µ—Ç–∞–ª–∏',
        noEvents: '–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π ‚Äî –Ω–∞—á–Ω–∏—Ç–µ —Ç–µ—Å—Ç.',
        leftClick: '–õ–ö–ú',
        middleClick: '–°–ö–ú',
        rightClick: '–ü–ö–ú',
        mouseDown: '–ù–∞–∂–∞—Ç–∏–µ –º—ã—à–∏',
        mouseUp: '–û—Ç–ø—É—Å–∫–∞–Ω–∏–µ –º—ã—à–∏',
        doubleClick: '–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫',
        wheelUp: '–ö–æ–ª–µ—Å–æ –≤–≤–µ—Ä—Ö',
        wheelDown: '–ö–æ–ª–µ—Å–æ –≤–Ω–∏–∑',
        wheelReversal: '–†–µ–≤–µ—Ä—Å –∫–æ–ª–µ—Å–∞',
        keyDown: '–ù–∞–∂–∞—Ç–∏–µ –∫–ª–∞–≤–∏—à–∏',
        keyUp: '–û—Ç–ø—É—Å–∫–∞–Ω–∏–µ –∫–ª–∞–≤–∏—à–∏',
        adBlock: '–†–µ–∫–ª–∞–º–Ω—ã–π –±–ª–æ–∫ (300x250 / –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π)',
        topBanner: '–†–µ–∫–ª–∞–º–Ω—ã–π –±–∞–Ω–Ω–µ—Ä (728x90 / –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π)',
        exportTitle: '–û—Ç—á–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º—ã—à–∏',
        exportDate: '–î–∞—Ç–∞:',
        exportStats: '–°–¢–ê–¢–ò–°–¢–ò–ö–ê:',
        exportDoubleClicks: '–î–≤–æ–π–Ω—ã–µ –∫–ª–∏–∫–∏',
        exportWheelSteps: '–®–∞–≥–æ–≤ –∫–æ–ª–µ—Å–∞:',
        exportWheelReversals: '–†–µ–≤–µ—Ä—Å—ã –∫–æ–ª–µ—Å–∞:',
        exportReversalRate: '–î–æ–ª—è —Ä–µ–≤–µ—Ä—Å–æ–≤:',
        exportLogs: '–õ–û–ì–ò –°–û–ë–´–¢–ò–ô:',
        parameters: '–ü–∞—Ä–∞–º–µ—Ç—Ä—ã',
        statistics: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', 
        testZone: '–ó–æ–Ω–∞ —Ç–µ—Å—Ç–∞ –º—ã—à–∏',
        testZoneDescription: '–ö–ª–∏–∫–∞–π—Ç–µ –õ–ö–ú/–°–ö–ú/–ü–ö–ú –∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–π—Ç–µ –∫–æ–ª–µ—Å–æ. –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –∏ –∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π –∑–æ–Ω—ã.',
        footer: '–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.<br>2025',
        doubleClickThreshold: '–ü–æ—Ä–æ–≥ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞ (–º—Å)',
        doubleClickHelp: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∫–ª–∏–∫–∞–º–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ: 150-250–º—Å.',
        reverseWindowLabel: '–û–∫–Ω–æ —Ä–µ–≤–µ—Ä—Å–∞ –∫–æ–ª–µ—Å–∞ (–º—Å)',
        reverseWindowHelp: '–ï—Å–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—è–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ —ç—Ç–æ–≥–æ –æ–∫–Ω–∞ ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ä–µ–≤–µ—Ä—Å.',
        doubleClicksLMB: '–î–∞–±–±–ª-–∫–ª–∏–∫–∏ LMB:',
        doubleClicksMMB: '–î–∞–±–±–ª-–∫–ª–∏–∫–∏ MMB:',
        doubleClicksRMB: '–î–∞–±–±–ª-–∫–ª–∏–∫–∏ RMB:',
        wheelStepsCount: '–ö–æ–ª-–≤–æ —à–∞–≥–æ–≤ –∫–æ–ª–µ—Å–∞:',
        wheelReversalsCount: '–†–µ–≤–µ—Ä—Å—ã –∫–æ–ª–µ—Å–∞:',
        hintLeftButton: '–õ–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞:',
        hintLeftText: '–±—ã—Å—Ç—Ä–æ –∫–ª–∏–∫–∞–π—Ç–µ –¥–ª—è —Ç–µ—Å—Ç–∞ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞',
        hintMiddleButton: '–°—Ä–µ–¥–Ω—è—è –∫–Ω–æ–ø–∫–∞:',
        hintMiddleText: '–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –∫–æ–ª–µ—Å–∏–∫–∞ –∫–∞–∫ –∫–Ω–æ–ø–∫–∏',
        hintRightButton: '–ü—Ä–∞–≤–∞—è –∫–Ω–æ–ø–∫–∞:',
        hintRightText: '–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –æ—Ç–∫–ª—é—á–µ–Ω–æ',
        hintWheel: '–ö–æ–ª–µ—Å–æ:',
        hintWheelText: '–º–µ–Ω—è–π—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∞ —Ä–µ–≤–µ—Ä—Å–æ–≤'
      },
      en: {
        title: 'Mouse & Keyboard Tester',
        clear: 'üóëÔ∏è Clear',
        export: 'üì• Export',
        lightTheme: '‚òÄÔ∏è Light',
        darkTheme: 'üåô Dark',
        lang: 'üá∫üá∏ English',
        modeMouseTest: 'üñ±Ô∏è Mouse',
        modeKeyboardTest: '‚å®Ô∏è Keyboard',
        doubleClickSpeed: 'Double Click Speed:',
        ms: 'ms',
        wheelSettings: 'Wheel Settings:',
        reversalWindow: 'Reversal Window:',
        mouseButtons: 'Mouse Buttons',
        wheelScroll: 'Wheel Scroll',
        reversals: 'Reversals',
        keyboard: 'Keyboard',
        logs: 'Logs (last 1000)',
        time: 'Time',
        event: 'Event',
        details: 'Details',
        noEvents: 'No events ‚Äî start testing.',
        leftClick: 'LMB',
        middleClick: 'MMB',
        rightClick: 'RMB',
        mouseDown: 'Mouse Down',
        mouseUp: 'Mouse Up',
        doubleClick: 'Double Click',
        wheelUp: 'Wheel Up',
        wheelDown: 'Wheel Down',
        wheelReversal: 'Wheel Reversal',
        keyDown: 'Key Down',
        keyUp: 'Key Up',
        adBlock: 'Advertisement Block (300x250 / Responsive)',
        topBanner: 'Advertisement Banner (728x90 / Responsive)',
        exportTitle: 'Mouse Testing Report',
        exportDate: 'Date:',
        exportStats: 'STATISTICS:',
        exportDoubleClicks: 'Double clicks',
        exportWheelSteps: 'Wheel steps:',
        exportWheelReversals: 'Wheel reversals:',
        exportReversalRate: 'Reversal rate:',
        exportLogs: 'EVENT LOGS:',
        parameters: 'Parameters',
        statistics: 'Statistics',
        testZone: 'Mouse Test Zone',
        testZoneDescription: 'Click LMB/MMB/RMB and scroll the wheel. Context menu and auto-scroll are disabled within this zone.',
        footer: 'All rights reserved.<br>2025',
        doubleClickThreshold: 'Double click threshold (ms)',
        doubleClickHelp: 'Maximum interval between clicks to register a double click. Standard: 150-250ms.',
        reverseWindowLabel: 'Wheel reversal window (ms)',
        reverseWindowHelp: 'If direction changes faster than this window ‚Äî register reversal.',
        doubleClicksLMB: 'Double-clicks LMB:',
        doubleClicksMMB: 'Double-clicks MMB:',
        doubleClicksRMB: 'Double-clicks RMB:',
        wheelStepsCount: 'Wheel steps count:',
        wheelReversalsCount: 'Wheel reversals:',
        hintLeftButton: 'Left Button:',
        hintLeftText: 'click quickly to test double-click',
        hintMiddleButton: 'Middle Button:',
        hintMiddleText: 'test wheel as button functionality',
        hintRightButton: 'Right Button:',
        hintRightText: 'context menu is disabled',
        hintWheel: 'Wheel:',
        hintWheelText: 'change direction to test reversals'
      }
    };

    // ------- Elements -------
    const elDblThreshold = document.getElementById('dbl-threshold');
    const elRevWindow = document.getElementById('reverse-window');

    const elDblL = document.getElementById('dbl-lmb');
    const elDblM = document.getElementById('dbl-mmb');
    const elDblR = document.getElementById('dbl-rmb');
    const elWheelTotal = document.getElementById('wheel-total');
    const elWheelRev = document.getElementById('wheel-rev');

    const testArea = document.getElementById('test-area');
    const notificationArea = document.getElementById('notification-area');

    const indL = document.getElementById('ind-lmb');
    const indM = document.getElementById('ind-mmb');
    const indR = document.getElementById('ind-rmb');

    const wheelLabel = document.getElementById('wheel-label');
    const arrowUp = document.getElementById('arrow-up');
    const arrowDown = document.getElementById('arrow-down');

    const logBody = document.getElementById('log-body');

    const btnReset = document.getElementById('btn-reset');
    const btnExport = document.getElementById('btn-export');
    const btnTheme = document.getElementById('btn-theme');
    const btnLang = document.getElementById('btn-lang');
    const btnMode = document.getElementById('btn-mode');

    // ------- Utils -------
    const now = () => Date.now();
    const fmtTime = (ms) => new Date(ms).toLocaleTimeString(currentLang === 'ru' ? 'ru-RU' : 'en-US', { hour12: false });

    function showNotification(message, type = 'default') {
      const notification = document.createElement('div');
      const bgColor = type === 'doubleclick' ? 'bg-red-600' : 
                     type === 'reversal' ? 'bg-orange-600' : 'bg-blue-600';
      
      notification.className = `px-3 py-2 ${bgColor} text-white rounded-lg text-sm font-medium shadow-lg transform transition-all duration-300 translate-x-full opacity-0`;
      notification.textContent = message;
      
      notificationArea.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.classList.remove('translate-x-full', 'opacity-0');
      }, 10);
      
      // Animate out and remove
      setTimeout(() => {
        notification.classList.add('translate-x-full', 'opacity-0');
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 2000);
    }

    function playNotificationSound(type) {
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        // –†–∞–∑–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
        const frequency = type === 'doubleclick' ? 800 : type === 'reversal' ? 600 : 500;
        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
        oscillator.type = 'sine';
        
        // –ö–æ—Ä–æ—Ç–∫–∏–π –∑–≤—É–∫
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      } catch (e) {
        // –ó–≤—É–∫ –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
      }
    }

    function updateInterface() {
      const t = translations[currentLang];
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
      document.querySelector('h1').textContent = t.title;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
      btnReset.textContent = t.clear;
      btnExport.textContent = t.export;
      btnLang.textContent = t.lang;
      btnMode.textContent = testMode === 'mouse' ? t.modeMouseTest : t.modeKeyboardTest;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Ç–µ–º—ã
      if (isDarkTheme) {
        btnTheme.textContent = t.lightTheme;
      } else {
        btnTheme.textContent = t.darkTheme;
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π
      const h2Elements = document.querySelectorAll('h2');
      if (h2Elements.length >= 4) {
        h2Elements[0].textContent = t.parameters;  // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
        h2Elements[1].textContent = t.statistics;  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        h2Elements[2].textContent = t.testZone;    // –ó–æ–Ω–∞ —Ç–µ—Å—Ç–∞ –º—ã—à–∏
        h2Elements[3].textContent = t.logs;        // –õ–æ–≥–∏
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –∑–æ–Ω—ã —Ç–µ—Å—Ç–∞
      const testZoneDesc = document.querySelector('#test-area p');
      if (testZoneDesc) {
        testZoneDesc.textContent = t.testZoneDescription;
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ (—Ç–µ–ø–µ—Ä—å –æ–Ω–∏ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ—Ç–∫–µ)
      const hints = document.querySelectorAll('#test-area .bg-slate-800\\/50 .grid div');
      if (hints.length >= 4) {
        hints[0].innerHTML = `üí° <strong>${t.hintLeftButton}</strong> ${t.hintLeftText}`;
        hints[1].innerHTML = `üí° <strong>${t.hintMiddleButton}</strong> ${t.hintMiddleText}`;
        hints[2].innerHTML = `üí° <strong>${t.hintRightButton}</strong> ${t.hintRightText}`;
        hints[3].innerHTML = `üí° <strong>${t.hintWheel}</strong> ${t.hintWheelText}`;
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∫–Ω–æ–ø–æ–∫ –º—ã—à–∏
      const lmbIndicator = document.querySelector('#ind-lmb span');
      const mmbIndicator = document.querySelector('#ind-mmb span');
      const rmbIndicator = document.querySelector('#ind-rmb span');
      if (lmbIndicator) lmbIndicator.textContent = t.leftClick;
      if (mmbIndicator) mmbIndicator.textContent = t.middleClick;
      if (rmbIndicator) rmbIndicator.textContent = t.rightClick;

      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
      const tableHeaders = document.querySelectorAll('th');
      if (tableHeaders.length >= 3) {
        tableHeaders[0].textContent = t.time;
        tableHeaders[1].textContent = t.event;
        tableHeaders[2].textContent = t.details;
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä—Ö–Ω–∏–π –±–∞–Ω–Ω–µ—Ä
      const topBannerTexts = document.querySelectorAll('.bg-slate-800\\/60');
      if (topBannerTexts.length >= 2) {
        topBannerTexts[0].textContent = t.topBanner; // –≤–µ—Ä—Ö–Ω–∏–π –±–∞–Ω–Ω–µ—Ä
        topBannerTexts[1].textContent = t.adBlock;   // –Ω–∏–∂–Ω–∏–π –±–ª–æ–∫
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º footer
      const footerText = document.querySelector('footer p');
      if (footerText) {
        footerText.innerHTML = t.footer;
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–µ–π–±–ª—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
      const dblThresholdInput = document.querySelector('input[id="dbl-threshold"]');
      if (dblThresholdInput && dblThresholdInput.previousElementSibling) {
        dblThresholdInput.previousElementSibling.textContent = t.doubleClickThreshold;
      }
      
      const reverseWindowInput = document.querySelector('input[id="reverse-window"]');
      if (reverseWindowInput && reverseWindowInput.previousElementSibling) {
        reverseWindowInput.previousElementSibling.textContent = t.reverseWindowLabel;
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
      const dblThresholdHelp = document.querySelector('input[id="dbl-threshold"]')?.nextElementSibling;
      if (dblThresholdHelp) {
        dblThresholdHelp.textContent = t.doubleClickHelp;
      }
      
      const reverseWindowHelp = document.querySelector('input[id="reverse-window"]')?.nextElementSibling;
      if (reverseWindowHelp) {
        reverseWindowHelp.textContent = t.reverseWindowHelp;
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
      const statLabels = document.querySelectorAll('li span:first-child');
      if (statLabels.length >= 5) {
        statLabels[0].textContent = t.doubleClicksLMB;
        statLabels[1].textContent = t.doubleClicksMMB;
        statLabels[2].textContent = t.doubleClicksRMB;
        statLabels[3].textContent = t.wheelStepsCount;
        statLabels[4].textContent = t.wheelReversalsCount;
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –¥–≤–æ–π–Ω—ã—Ö –∫–ª–∏–∫–æ–≤
      updateDoubleCounts();
      
      // –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–º –ª–æ–≥–∏
      renderLogs();
    }

    function pushLog(item) {
      logs.unshift(item);
      if (logs.length > 1000) logs.pop();
      renderLogs();
    }

    function renderLogs() {
      const t = translations[currentLang];
      if (logs.length === 0) {
        logBody.innerHTML = `<tr><td class="py-2 text-slate-500 text-center" colspan="3">${t.noEvents}</td></tr>`;
        return;
      }
      const rows = logs.map((l) => {
        const { event, details, isSpecial } = formatLogEvent(l);
        const rowClass = isSpecial ? 'border-t border-slate-800/60 bg-red-900/20' : 'border-t border-slate-800/60';
        const textClass = isSpecial ? 'text-red-300' : 'text-slate-300';
        return `<tr class="${rowClass}">
          <td class="py-1 font-mono text-xs text-center w-20">${fmtTime(l.t)}</td>
          <td class="py-1 text-center w-24 ${isSpecial ? 'text-red-400 font-semibold' : ''}">${event}</td>
          <td class="py-1 text-center ${textClass} break-words">${details}</td>
        </tr>`;
      }).join('');
      logBody.innerHTML = rows;
    }

    function updateDoubleCounts() {
      const t = translations[currentLang];
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —è–∑—ã–∫–∞
      if (!doubleCounts[t.leftClick]) {
        doubleCounts[t.leftClick] = 0;
        doubleCounts[t.middleClick] = 0;
        doubleCounts[t.rightClick] = 0;
      }
    }

    function updateStats() {
      const t = translations[currentLang];
      elDblL.textContent = String(doubleCounts[t.leftClick] || 0);
      elDblM.textContent = String(doubleCounts[t.middleClick] || 0);
      elDblR.textContent = String(doubleCounts[t.rightClick] || 0);
      elWheelTotal.textContent = String(wheelStats.total);
      elWheelRev.textContent = String(wheelStats.reversals);
    }

    function setIndicator(el, active) {
      el.classList.toggle('border-emerald-500', active);
      el.classList.toggle('bg-emerald-500/10', active);
      const dot = el.querySelector('span.size-3');
      if (dot) {
        dot.classList.toggle('bg-emerald-500', active);
        dot.classList.toggle('bg-slate-700', !active);
      }
    }

    function setWheelArrow(dir) {
      arrowUp.classList.toggle('border-emerald-500', dir === 'up');
      arrowUp.classList.toggle('bg-emerald-500/10', dir === 'up');
      arrowDown.classList.toggle('border-emerald-500', dir === 'down');
      arrowDown.classList.toggle('bg-emerald-500/10', dir === 'down');
      
      if (dir === 'idle') {
        arrowUp.classList.add('border-slate-800','bg-slate-900');
        arrowDown.classList.add('border-slate-800','bg-slate-900');
      }
    }

    function resetAll() {
      logs.length = 0;
      const t = translations[currentLang];
      doubleCounts[t.leftClick] = doubleCounts[t.middleClick] = doubleCounts[t.rightClick] = 0;
      wheelStats.reversals = 0; wheelStats.total = 0;
      renderLogs(); updateStats();
    }

    // ------- Event Handlers -------
    elDblThreshold.addEventListener('input', () => {
      dblThresholdMs = parseInt(elDblThreshold.value || '0', 10);
    });

    elRevWindow.addEventListener('input', () => {
      reverseWindowMs = parseInt(elRevWindow.value || '0', 10);
    });

    btnReset.addEventListener('click', resetAll);

    btnExport.addEventListener('click', () => {
      // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç
      const reversedLogs = [...logs].reverse();
      const t = translations[currentLang];
      let textContent = `${t.exportTitle}\n`;
      textContent += `${t.exportDate} ${new Date().toLocaleString(currentLang === 'ru' ? 'ru-RU' : 'en-US')}\n`;
      textContent += `=====================================\n\n`;
      
      textContent += `${t.exportStats}\n`;
      textContent += `- ${t.exportDoubleClicks} ${t.leftClick}: ${doubleCounts[t.leftClick] || 0}\n`;
      textContent += `- ${t.exportDoubleClicks} ${t.middleClick}: ${doubleCounts[t.middleClick] || 0}\n`;
      textContent += `- ${t.exportDoubleClicks} ${t.rightClick}: ${doubleCounts[t.rightClick] || 0}\n`;
      textContent += `- ${t.exportWheelSteps} ${wheelStats.total}\n`;
      textContent += `- ${t.exportWheelReversals} ${wheelStats.reversals}\n`;
      const rate = wheelStats.total ? (100 * wheelStats.reversals / wheelStats.total) : 0;
      textContent += `- ${t.exportReversalRate} ${rate.toFixed(1)}%\n\n`;
      
      textContent += `${t.exportLogs}\n`;
      textContent += `${t.time}\t\t${t.event}\t\t${t.details}\n`;
      textContent += `-----------------------------------------------\n`;
      
      reversedLogs.forEach(log => {
        const { event, details } = formatLogEvent(log);
        textContent += `${fmtTime(log.t)}\t\t${event}\t\t${details}\n`;
      });
      
      const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `mouse_test_${new Date().toISOString().replace(/[:.]/g, '-')}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    });

    function forceThemeUpdate() {
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
      const body = document.body;
      if (isDarkTheme) {
        body.classList.remove('light-theme');
        body.style.backgroundColor = 'rgb(2 6 23)';
        body.style.color = 'rgb(226 232 240)';
      } else {
        body.classList.add('light-theme');
        body.style.backgroundColor = 'rgb(248 250 252)';
        body.style.color = 'rgb(15 23 42)';
      }
      
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
      setTimeout(() => {
        document.querySelectorAll('*').forEach(el => {
          if (el.style) el.style.display = el.style.display || '';
        });
      }, 10);
    }

    btnTheme.addEventListener('click', () => {
      isDarkTheme = !isDarkTheme;
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä –≤ localStorage
      localStorage.setItem('mouseTestTheme', isDarkTheme ? 'dark' : 'light');
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–º—É
      forceThemeUpdate();
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Å—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∫–ª—é—á–∞—è –∫–Ω–æ–ø–∫—É —Ç–µ–º—ã
      updateInterface();
    });

    btnLang.addEventListener('click', () => {
      currentLang = currentLang === 'ru' ? 'en' : 'ru';
      localStorage.setItem('mouseTestLang', currentLang);
      updateInterface();
    });

    btnMode.addEventListener('click', () => {
      testMode = testMode === 'mouse' ? 'keyboard' : 'mouse';
      localStorage.setItem('mouseTestMode', testMode);
      updateInterface();
    });

    function buttonLabel(button) {
      const t = translations[currentLang];
      return button === 0 ? t.leftClick : button === 1 ? t.middleClick : t.rightClick;
    }

    function onMouseDown(e) {
      const t = now();
      const btn = e.button;
      const prev = lastDown[btn];
      const delta = t - prev;
      if (prev && delta <= dblThresholdMs) {
        const label = buttonLabel(btn);
        doubleCounts[label]++;
        pushLog({ t, type: 'double-click', details: { button: label, deltaMs: delta } });
        const tr = translations[currentLang];
        showNotification(`${tr.doubleClick} ${label}!`, 'doubleclick');
        updateStats();
      } else {
        pushLog({ t, type: 'click-down', details: { button: buttonLabel(btn) } });
      }
      lastDown[btn] = t;
      
      // Visual feedback
      if (btn === 0) setIndicator(indL, true);
      else if (btn === 1) setIndicator(indM, true);
      else if (btn === 2) setIndicator(indR, true);
    }

    function onMouseUp(e) {
      const t = now();
      const btn = e.button;
      pushLog({ t, type: 'click-up', details: { button: buttonLabel(btn) } });
      
      // Visual feedback
      if (btn === 0) setIndicator(indL, false);
      else if (btn === 1) setIndicator(indM, false);
      else if (btn === 2) setIndicator(indR, false);
    }

    function formatLogEvent(log) {
      let event = '';
      let details = '';
      let isSpecial = false; // –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –∫—Ä–∞—Å–Ω—ã–º
      const t = translations[currentLang];
      
      switch (log.type) {
        case 'click-down':
          event = log.details.button;
          details = t.mouseDown;
          break;
        case 'click-up':
          event = log.details.button;
          details = t.mouseUp;
          break;
        case 'double-click':
          event = log.details.button;
          details = `${t.doubleClick} (${log.details.deltaMs}${t.ms})`;
          isSpecial = true; // –≤—ã–¥–µ–ª—è–µ–º –¥–≤–æ–π–Ω—ã–µ –∫–ª–∏–∫–∏
          break;
        case 'wheel':
          event = currentLang === 'ru' ? '–ö–æ–ª–µ—Å–æ' : 'Wheel';
          details = log.details.dir === 'up' ? t.wheelUp : t.wheelDown;
          break;
        case 'wheel-reversal':
          event = currentLang === 'ru' ? '–ö–æ–ª–µ—Å–æ' : 'Wheel';
          details = t.wheelReversal;
          isSpecial = true; // –≤—ã–¥–µ–ª—è–µ–º —Ä–µ–≤–µ—Ä—Å—ã
          break;
        case 'info':
          event = currentLang === 'ru' ? '–°–∏—Å—Ç–µ–º–∞' : 'System';
          details = log.details.message;
          break;
        default:
          event = log.type;
          details = JSON.stringify(log.details || {});
      }
      
      return { event, details, isSpecial };
    }

    function onWheel(e) {
      // prevent page scroll while inside test area
      e.preventDefault();
      e.stopPropagation();
      const t = now();
      const sign = Math.sign(e.deltaY); // >0 = down, <0 = up
      const dir = sign > 0 ? 'down' : sign < 0 ? 'up' : 'idle';

      if (sign !== 0) {
        wheelStats.total++;
        updateStats();
      }

      const last = lastWheel;
      const since = t - last.t;
      if (last.sign !== 0 && sign !== 0 && sign !== last.sign && since <= reverseWindowMs) {
        wheelStats.reversals++;
        pushLog({ t, type: 'wheel-reversal', details: { sinceMs: since, from: last.sign > 0 ? 'down' : 'up', to: dir, deltaY: e.deltaY } });
        const tr = translations[currentLang];
        showNotification(`${tr.wheelReversal}! (${since}${tr.ms})`, 'reversal');
        updateStats();
      } else if (sign !== 0) {
        pushLog({ t, type: 'wheel', details: { dir, deltaY: e.deltaY } });
      }

      lastWheel.t = t; lastWheel.sign = sign;

      // Visual feedback
      setWheelArrow(dir);
      
      // Highlight test area during wheel events
      testArea.classList.add('ring-2', 'ring-emerald-500/50', 'bg-emerald-900/10');
      clearTimeout(wheelIdleTimer);
      wheelIdleTimer = setTimeout(() => {
        setWheelArrow('idle');
        testArea.classList.remove('ring-2', 'ring-emerald-500/50', 'bg-emerald-900/10');
      }, 200);
    }

    // ------- Event Listeners -------
    testArea.addEventListener('mousedown', onMouseDown);
    testArea.addEventListener('mouseup', onMouseUp);
    testArea.addEventListener('wheel', onWheel, { passive: false });
    testArea.addEventListener('contextmenu', (e) => e.preventDefault());

    testArea.addEventListener('mouseleave', () => {
      setIndicator(indL, false);
      setIndicator(indM, false);
      setIndicator(indR, false);
      setWheelArrow('idle');
      testArea.blur();
    });

    // Global wheel handler to prevent scrolling when not in test area
    window.addEventListener('wheel', (e) => {
      // Only prevent default if we're not in a scrollable container
      const target = e.target;
      const testAreaContains = testArea.contains(target);
      const isScrollable = target.closest('.overflow-auto, .overflow-y-auto, .overflow-scroll');
      
      if (testAreaContains && !isScrollable) {
        e.preventDefault();
      }
    }, { passive: false });

    // Accessibility: focus test area on load for immediate testing
    window.addEventListener('load', () => { 
      testArea.focus(); 
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –∏–∑ localStorage
      const savedTheme = localStorage.getItem('mouseTestTheme');
      if (savedTheme === 'light') {
        isDarkTheme = false;
      }
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
      forceThemeUpdate();
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–∞ –∏–∑ localStorage
      const savedLang = localStorage.getItem('mouseTestLang');
      if (savedLang && (savedLang === 'ru' || savedLang === 'en')) {
        currentLang = savedLang;
      }
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ –∏–∑ localStorage
      const savedMode = localStorage.getItem('mouseTestMode');
      if (savedMode && (savedMode === 'mouse' || savedMode === 'keyboard')) {
        testMode = savedMode;
      }
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –¥–≤–æ–π–Ω—ã—Ö –∫–ª–∏–∫–æ–≤
      updateDoubleCounts();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Å—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —è–∑—ã–∫–æ–º –∏ —Ç–µ–º–æ–π
      updateInterface();
    });
  </script>
</body>
</html>